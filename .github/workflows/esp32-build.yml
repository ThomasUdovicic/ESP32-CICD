name: ESP32 Firmware CI

on:
    push:
        branches: [ main, develop, feature/** ]
    pull_request:

jobs:
    build:
        runs-on: ubuntu-latest
        
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  submodules: recursive

            - name: Build with ESP-IDF
              uses: espressif/esp-idf-ci-action@v1
              with:
                    esp_idf_version: v5.1
                    target: esp32s3
                    path: .

            - name: Upload firmware artifacts
              uses: actions/upload-artifact@v4
              with:
                name: firmware-build
                path: |
                  build/**/*.bin
                  build/**/*.elf